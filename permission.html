<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß üíï</title>
<style>
body{
    font-family: Arial, sans-serif;
    background: #ffe6f0;
    text-align:center;
    padding:20px;
}
.box{
    background:white;
    padding:20px;
    border-radius:15px;
    max-width:400px;
    margin:auto;
    box-shadow:0 5px 15px rgba(0,0,0,0.2);
}
input{
    width:90%;
    padding:8px;
    margin:8px 0;
}
button{
    padding:10px 15px;
    margin:5px;
    border:none;
    border-radius:10px;
    cursor:pointer;
}
.primary{
    background:#ff4da6;
    color:white;
}
.allow{
    background:#4CAF50;
    color:white;
}
.deny{
    background:#f44336;
    color:white;
}
.linkBox{
    background:#f2f2f2;
    padding:10px;
    word-break:break-all;
    margin-top:10px;
}
</style>
</head>
<body>

<div class="box" id="requestPage">
<h2>üíå ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</h2>

<input type="text" id="place" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà">
<input type="text" id="withWho" placeholder="‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£‡∏ö‡πâ‡∏≤‡∏á">
<input type="time" id="backTime">

<br>
<button class="primary" onclick="createLink()">‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</button>

<div id="linkArea"></div>
<div id="statusArea"></div>

</div>

<div class="box" id="approvePage" style="display:none;">
<h2>üì© ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</h2>
<p id="showData"></p>

<button class="allow" onclick="sendResult('‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï')">‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï üíö</button>
<button class="deny" onclick="sendResult('‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï')">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï ‚ùå</button>

</div>

<script>

const urlParams = new URLSearchParams(window.location.search);
const requestId = urlParams.get("id");
const mode = urlParams.get("mode");

if(mode === "approve"){
    document.getElementById("requestPage").style.display="none";
    document.getElementById("approvePage").style.display="block";

    const data = JSON.parse(localStorage.getItem(requestId));
    if(data){
        document.getElementById("showData").innerHTML =
        "üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: " + data.place + "<br>" +
        "üë´ ‡πÑ‡∏õ‡∏Å‡∏±‡∏ö: " + data.withWho + "<br>" +
        "‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö: " + data.backTime;
    }
}

function createLink(){
    const place = document.getElementById("place").value;
    const withWho = document.getElementById("withWho").value;
    const backTime = document.getElementById("backTime").value;

    const id = Date.now().toString();

    localStorage.setItem(id, JSON.stringify({
        place,
        withWho,
        backTime,
        status: "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï"
    }));

    const link = window.location.origin + window.location.pathname + 
                 "?mode=approve&id=" + id;

    document.getElementById("linkArea").innerHTML =
    "<div class='linkBox'>" + link + "</div>" +
    "<button onclick='copyLink(\""+link+"\")'>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>";

    checkStatus(id);
}

function copyLink(link){
    navigator.clipboard.writeText(link);
    alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß üíï");
}

function sendResult(result){
    const data = JSON.parse(localStorage.getItem(requestId));
    data.status = result;
    localStorage.setItem(requestId, JSON.stringify(data));
    alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß üíå");
}

function checkStatus(id){
    setInterval(()=>{
        const data = JSON.parse(localStorage.getItem(id));
        if(data && data.status !== "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï"){
            document.getElementById("statusArea").innerHTML =
            "<h3>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï: "+ data.status +"</h3>";
        }
    },1000);
}

</script>

</body>
</html>
